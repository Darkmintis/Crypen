<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Crypen.Views.DashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Crypen.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:toolkit="using:CommunityToolkit.WinUI.UI.Controls"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
    
    <Page.Resources>
        <DataTemplate x:Key="DriveItemTemplate">
            <StackPanel Orientation="Horizontal" Spacing="8" Padding="4">
                <FontIcon Glyph="&#xE88E;" Foreground="{StaticResource CrypenAccentBrush}" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding Display}" VerticalAlignment="Center"/>
            </StackPanel>
        </DataTemplate>
    </Page.Resources>

    <Grid RowSpacing="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <TextBlock Grid.Row="0" Text="Dashboard" Style="{StaticResource TitleTextBlockStyle}" Margin="0,0,0,10"/>
        
        <!-- Action Buttons -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="12">
            <Button x:Name="EncryptFileButton" 
                    Content="Encrypt File" 
                    Style="{StaticResource CrypenPrimaryButtonStyle}" 
                    Click="EncryptFileButton_Click"/>
            
            <Button x:Name="EncryptFolderButton" 
                    Content="Encrypt Folder" 
                    Style="{StaticResource CrypenSecondaryButtonStyle}" 
                    Click="EncryptFolderButton_Click"/>
            
            <Button x:Name="EncryptUsbButton" 
                    Content="Encrypt USB" 
                    Style="{StaticResource CrypenAccentButtonStyle}" 
                    Click="EncryptUsbButton_Click"/>
        </StackPanel>
        
        <!-- Recent Items -->
        <Grid Grid.Row="2" RowSpacing="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <TextBlock Grid.Row="0" Text="Recent Items" Style="{StaticResource SubtitleTextBlockStyle}"/>
            
            <toolkit:DataGrid Grid.Row="1" 
                           x:Name="RecentItemsGrid" 
                           AutoGenerateColumns="False" 
                           IsReadOnly="True"
                           GridLinesVisibility="Horizontal"
                           SelectionMode="Single"
                           DoubleTapped="RecentItemsGrid_DoubleTapped">
                <toolkit:DataGrid.Columns>
                    <toolkit:DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
                    <toolkit:DataGridTextColumn Header="Type" Binding="{Binding ItemType}" Width="SizeToHeader"/>
                    <toolkit:DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="SizeToHeader"/>
                    <toolkit:DataGridTextColumn Header="Date Encrypted" Binding="{Binding EncryptedAt}" Width="SizeToHeader"/>
                    <toolkit:DataGridTemplateColumn Header="Actions" Width="Auto">
                        <toolkit:DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <Button Content="Decrypt" 
                                            Tag="{Binding Path}" 
                                            Click="DecryptButton_Click" 
                                            Visibility="{Binding Status, Converter={StaticResource StatusToVisibilityConverter}, ConverterParameter='Encrypted'}"
                                            Style="{StaticResource CrypenPrimaryButtonStyle}"/>
                                </StackPanel>
                            </DataTemplate>
                        </toolkit:DataGridTemplateColumn.CellTemplate>
                    </toolkit:DataGridTemplateColumn>
                </toolkit:DataGrid.Columns>
            </toolkit:DataGrid>
            
            <!-- Empty state message -->
            <TextBlock Grid.Row="1" 
                       Text="No encrypted items yet. Use the buttons above to encrypt your first item." 
                       HorizontalAlignment="Center" 
                       VerticalAlignment="Center" 
                       Foreground="Gray"
                       TextAlignment="Center"
                       Visibility="{Binding ElementName=RecentItemsGrid, Path=Items.Count, Converter={StaticResource EmptyCollectionToVisibilityConverter}}"/>
        </Grid>
    </Grid>
</Page>
